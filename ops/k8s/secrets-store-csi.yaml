apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: kv-secrets
  namespace: ecom
spec:
  provider: azure
  parameters:
    usePodIdentity: "false"
    useVMManagedIdentity: "true"
    userAssignedIdentityID: "" # set if using UAMI
    keyvaultName: "<your-kv-name>"
    cloudName: "" 
    objects: |
      array:
        - | 
          objectName: COSMOS_CONN_STR
          objectType: secret
        - | 
          objectName: SERVICEBUS_CONN_STR
          objectType: secret
        - | 
          objectName: REDIS_CONN_STR
          objectType: secret
        - |
          objectName: STRIPE_SECRET
          objectType: secret
    tenantId: "<tenant-guid>"
  secretObjects:
  - secretName: app-secrets
    type: Opaque
    data:
    - objectName: COSMOS_CONN_STR
      key: COSMOS_CONN_STR
    - objectName: SERVICEBUS_CONN_STR
      key: SERVICEBUS_CONN_STR
    - objectName: REDIS_CONN_STR
      key: REDIS_CONN_STR
    - objectName: STRIPE_SECRET
      key: STRIPE_SECRET